{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.functionExternalCases = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst debug = (0, debug_1.default)(\"codec:wrap:function\");\nconst dispatch_1 = require(\"./dispatch\");\nconst errors_1 = require(\"./errors\");\nconst Messages = __importStar(require(\"./messages\"));\nconst Utils = __importStar(require(\"./utils\"));\nconst EvmUtils = __importStar(require(\"../evm/utils\"));\nconst web3_utils_1 = __importDefault(require(\"web3-utils\"));\nconst address_1 = require(\"./address\");\nconst bytes_1 = require(\"./bytes\");\nconst functionExternalCasesBasic = [functionFromFunctionExternalInput, functionFromHexString, functionFromCodecFunctionExternalValue, functionFailureCase];\nexports.functionExternalCases = [functionFromTypeValueInput, ...functionExternalCasesBasic];\nfunction* functionFromFunctionExternalInput(dataType, input, wrapOptions) {\n  if (!Utils.isFunctionExternalInput(input)) {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 1, \"Input was not an object with address & selector\");\n  }\n  const wrappedAddress = yield* (0, dispatch_1.wrapWithCases)({\n    typeClass: \"address\",\n    kind: \"general\"\n  }, input.address, Object.assign(Object.assign({}, wrapOptions), {\n    name: `${wrapOptions.name}.address`,\n    specificityFloor: 5\n  }), address_1.addressCases);\n  const address = wrappedAddress.value.asAddress;\n  const wrappedSelector = yield* (0, dispatch_1.wrapWithCases)({\n    typeClass: \"bytes\",\n    kind: \"static\",\n    length: 4\n  }, input.selector, Object.assign(Object.assign({}, wrapOptions), {\n    name: `${wrapOptions.name}.selector`,\n    specificityFloor: 5\n  }), bytes_1.bytesCases);\n  const selector = wrappedSelector.value.asHex;\n  //note validation & normalization have already been performed\n  return {\n    type: dataType,\n    kind: \"value\",\n    value: {\n      kind: \"unknown\",\n      contract: {\n        kind: \"unknown\",\n        address\n      },\n      selector\n    }\n  };\n}\nfunction* functionFromCodecFunctionExternalValue(dataType, input, wrapOptions) {\n  if (!Utils.isWrappedResult(input)) {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 1, \"Input was not a wrapped result\");\n  }\n  if (input.type.typeClass !== \"function\" || input.type.visibility !== \"external\") {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 5, Messages.wrappedTypeMessage(input.type));\n  }\n  if (input.kind !== \"value\") {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 5, Messages.errorResultMessage);\n  }\n  const coercedInput = input;\n  const address = coercedInput.value.contract.address;\n  const selector = coercedInput.value.selector;\n  //we can skip validation & normalization here\n  return {\n    type: dataType,\n    kind: \"value\",\n    value: {\n      kind: \"unknown\",\n      contract: {\n        kind: \"unknown\",\n        address\n      },\n      selector\n    }\n  };\n}\nfunction* functionFromHexString(dataType, input, wrapOptions) {\n  if (typeof input !== \"string\") {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 1, \"Input was not a string\");\n  }\n  if (!Utils.isByteString(input)) {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 5, \"Input was a string, but not a valid even-length hex string\");\n  }\n  if (input.length !== 2 + 2 * (EvmUtils.ADDRESS_SIZE + EvmUtils.SELECTOR_SIZE)) {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 5, Messages.wrongLengthMessage(\"external function was given as a string but\", EvmUtils.ADDRESS_SIZE + EvmUtils.SELECTOR_SIZE, (input.length - 2) / 2));\n  }\n  let address = input.slice(0, EvmUtils.ADDRESS_SIZE * 2 + 2).toLowerCase();\n  const selector = \"0x\" + input.slice(EvmUtils.ADDRESS_SIZE * 2 + 2).toLowerCase();\n  //address & selector must now have the correct length, and we are deliberately *not*\n  //checking the checksum on address in this case.  So, the only thing remaining\n  //to do is to normalize address.\n  address = web3_utils_1.default.toChecksumAddress(address);\n  //...and return\n  return {\n    type: dataType,\n    kind: \"value\",\n    value: {\n      kind: \"unknown\",\n      contract: {\n        kind: \"unknown\",\n        address\n      },\n      selector\n    }\n  };\n}\nfunction* functionFromTypeValueInput(dataType, input, wrapOptions) {\n  if (!Utils.isTypeValueInput(input)) {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 1, \"Input was not a type/value pair\");\n  }\n  if (input.type !== \"function\") {\n    throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 5, Messages.specifiedTypeMessage(input.type));\n  }\n  //extract value & try again, with loose option turned on\n  return yield* (0, dispatch_1.wrapWithCases)(dataType, input.value, Object.assign(Object.assign({}, wrapOptions), {\n    loose: true\n  }), functionExternalCasesBasic);\n}\nfunction* functionFailureCase(dataType, input, wrapOptions) {\n  throw new errors_1.TypeMismatchError(dataType, input, wrapOptions.name, 2, \"Input should be one of: an object with address and selector; a 24-byte hex string; a type/value pair; or a wrapped external function\");\n}","map":{"version":3,"names":["debug_1","__importDefault","require","debug","default","dispatch_1","errors_1","Messages","__importStar","Utils","EvmUtils","web3_utils_1","address_1","bytes_1","functionExternalCasesBasic","functionFromFunctionExternalInput","functionFromHexString","functionFromCodecFunctionExternalValue","functionFailureCase","exports","functionExternalCases","functionFromTypeValueInput","dataType","input","wrapOptions","isFunctionExternalInput","TypeMismatchError","name","wrappedAddress","wrapWithCases","typeClass","kind","address","Object","assign","specificityFloor","addressCases","value","asAddress","wrappedSelector","length","selector","bytesCases","asHex","type","contract","isWrappedResult","visibility","wrappedTypeMessage","errorResultMessage","coercedInput","isByteString","ADDRESS_SIZE","SELECTOR_SIZE","wrongLengthMessage","slice","toLowerCase","toChecksumAddress","isTypeValueInput","specifiedTypeMessage","loose"],"sources":["../../../lib/wrap/function.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}