{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decodeMagic = exports.decodeSpecial = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst debug = (0, debug_1.default)(\"codec:special:decode\");\nconst Basic = __importStar(require(\"../../basic\"));\nconst Bytes = __importStar(require(\"../../bytes\"));\nconst Compiler = __importStar(require(\"../../compiler\"));\nconst Evm = __importStar(require(\"../../evm\"));\nfunction* decodeSpecial(dataType, pointer, info) {\n  if (dataType.typeClass === \"magic\") {\n    return yield* decodeMagic(dataType, pointer, info);\n  } else {\n    return yield* Basic.Decode.decodeBasic(dataType, pointer, info);\n  }\n}\nexports.decodeSpecial = decodeSpecial;\nfunction* decodeMagic(dataType, pointer, info) {\n  let {\n    state\n  } = info;\n  switch (pointer.special) {\n    case \"msg\":\n      return {\n        type: dataType,\n        kind: \"value\",\n        value: {\n          data: yield* Bytes.Decode.decodeBytes({\n            typeClass: \"bytes\",\n            kind: \"dynamic\",\n            location: \"calldata\"\n          }, {\n            location: \"calldata\",\n            start: 0,\n            length: state.calldata.length\n          }, info),\n          sig: yield* Basic.Decode.decodeBasic({\n            typeClass: \"bytes\",\n            kind: \"static\",\n            length: Evm.Utils.SELECTOR_SIZE\n          }, {\n            location: \"calldata\",\n            start: 0,\n            length: Evm.Utils.SELECTOR_SIZE\n          }, info),\n          sender: yield* Basic.Decode.decodeBasic(senderType(info.currentContext.compiler), {\n            location: \"special\",\n            special: \"sender\"\n          }, info),\n          value: yield* Basic.Decode.decodeBasic({\n            typeClass: \"uint\",\n            bits: 256\n          }, {\n            location: \"special\",\n            special: \"value\"\n          }, info)\n        }\n      };\n    case \"tx\":\n      return {\n        type: dataType,\n        kind: \"value\",\n        value: {\n          origin: yield* Basic.Decode.decodeBasic(senderType(info.currentContext.compiler), {\n            location: \"special\",\n            special: \"origin\"\n          }, info),\n          gasprice: yield* Basic.Decode.decodeBasic({\n            typeClass: \"uint\",\n            bits: 256\n          }, {\n            location: \"special\",\n            special: \"gasprice\"\n          }, info)\n        }\n      };\n    case \"block\":\n      let block = {\n        coinbase: yield* Basic.Decode.decodeBasic(coinbaseType(info.currentContext.compiler), {\n          location: \"special\",\n          special: \"coinbase\"\n        }, info)\n      };\n      //now we handle prevrandao. this one gets special handling\n      //because the name isn't equal to the location name (it's an alias of difficulty)\n      if (solidityVersionHasPrevrandao(info.currentContext.compiler)) {\n        block.prevrandao = yield* Basic.Decode.decodeBasic({\n          typeClass: \"uint\",\n          bits: 256\n        }, {\n          location: \"special\",\n          special: \"difficulty\"\n        }, info);\n      }\n      //the other ones are all uint's and all work the same, so let's handle\n      //them all at once; due to the lack of generator arrow functions, we do\n      //it by mutating block\n      const variables = [\"difficulty\", \"gaslimit\", \"number\", \"timestamp\"];\n      if (solidityVersionHasChainId(info.currentContext.compiler)) {\n        variables.push(\"chainid\");\n      }\n      if (solidityVersionHasBaseFee(info.currentContext.compiler)) {\n        variables.push(\"basefee\");\n      }\n      for (let variable of variables) {\n        block[variable] = yield* Basic.Decode.decodeBasic({\n          typeClass: \"uint\",\n          bits: 256\n        }, {\n          location: \"special\",\n          special: variable\n        }, info);\n      }\n      return {\n        type: dataType,\n        kind: \"value\",\n        value: block\n      };\n  }\n}\nexports.decodeMagic = decodeMagic;\nfunction senderType(compiler) {\n  switch (Compiler.Utils.solidityFamily(compiler)) {\n    case \"unknown\":\n    case \"pre-0.5.0\":\n      return {\n        typeClass: \"address\",\n        kind: \"general\"\n      };\n    case \"0.5.x\":\n      return {\n        typeClass: \"address\",\n        kind: \"specific\",\n        payable: true\n      };\n    default:\n      return {\n        typeClass: \"address\",\n        kind: \"specific\",\n        payable: false\n      };\n  }\n}\nfunction coinbaseType(compiler) {\n  switch (Compiler.Utils.solidityFamily(compiler)) {\n    case \"unknown\":\n    case \"pre-0.5.0\":\n      return {\n        typeClass: \"address\",\n        kind: \"general\"\n      };\n    case \"0.5.x\":\n    case \"0.8.x\":\n    case \"0.8.7+\":\n    case \"0.8.9+\":\n    case \"0.8.18+\":\n      return {\n        typeClass: \"address\",\n        kind: \"specific\",\n        payable: true\n      };\n  }\n}\nfunction solidityVersionHasChainId(compiler) {\n  switch (Compiler.Utils.solidityFamily(compiler)) {\n    case \"unknown\":\n    case \"pre-0.5.0\":\n    case \"0.5.x\":\n      return false;\n    default:\n      return true;\n  }\n}\nfunction solidityVersionHasBaseFee(compiler) {\n  switch (Compiler.Utils.solidityFamily(compiler)) {\n    case \"unknown\":\n    case \"pre-0.5.0\":\n    case \"0.5.x\":\n    case \"0.8.x\":\n      return false;\n    default:\n      return true;\n  }\n}\nfunction solidityVersionHasPrevrandao(compiler) {\n  switch (Compiler.Utils.solidityFamily(compiler)) {\n    case \"unknown\":\n    case \"pre-0.5.0\":\n    case \"0.5.x\":\n    case \"0.8.x\":\n    case \"0.8.7+\":\n    case \"0.8.9+\":\n      return false;\n    default:\n      return true;\n  }\n}","map":{"version":3,"names":["debug_1","__importDefault","require","debug","default","Basic","__importStar","Bytes","Compiler","Evm","decodeSpecial","dataType","pointer","info","typeClass","decodeMagic","Decode","decodeBasic","exports","state","special","type","kind","value","data","decodeBytes","location","start","length","calldata","sig","Utils","SELECTOR_SIZE","sender","senderType","currentContext","compiler","bits","origin","gasprice","block","coinbase","coinbaseType","solidityVersionHasPrevrandao","prevrandao","variables","solidityVersionHasChainId","push","solidityVersionHasBaseFee","variable","solidityFamily","payable"],"sources":["../../../../lib/special/decode/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}