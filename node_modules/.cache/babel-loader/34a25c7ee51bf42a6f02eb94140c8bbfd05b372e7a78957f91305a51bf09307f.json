{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Web3InterfaceAdapter = void 0;\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst shim_1 = require(\"../../shim\");\nclass Web3InterfaceAdapter {\n  constructor() {\n    let {\n      provider,\n      networkType\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.web3 = new shim_1.Web3Shim({\n      provider,\n      networkType\n    });\n  }\n  getNetworkId() {\n    return this.web3.eth.net.getId();\n  }\n  getBlock(block) {\n    return this.web3.eth.getBlock(block);\n  }\n  getTransaction(tx) {\n    return this.web3.eth.getTransaction(tx);\n  }\n  getTransactionReceipt(tx) {\n    return this.web3.eth.getTransactionReceipt(tx);\n  }\n  getBalance(address) {\n    return this.web3.eth.getBalance(address);\n  }\n  getCode(address) {\n    return this.web3.eth.getCode(address);\n  }\n  getAccounts() {\n    return this.web3.eth.getAccounts();\n  }\n  estimateGas(transactionConfig) {\n    let stacktrace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    return __awaiter(this, void 0, void 0, function* () {\n      // web3 does not error gracefully when gas estimation fails due to a revert,\n      // so in cases where we want to get past this (debugging/stacktracing), we must\n      // catch the error and return null instead\n      if (stacktrace === true) {\n        try {\n          const gasEstimate = yield this.web3.eth.estimateGas(transactionConfig);\n          return gasEstimate;\n        } catch (_a) {\n          return null;\n        }\n      } else {\n        return this.web3.eth.estimateGas(transactionConfig);\n      }\n    });\n  }\n  getBlockNumber() {\n    return this.web3.eth.getBlockNumber();\n  }\n  getTransactionCostReport(receipt) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const tx = yield this.getTransaction(receipt.transactionHash);\n      const block = yield this.getBlock(receipt.blockNumber);\n      if (!block) return null;\n      const balance = yield this.getBalance(tx.from);\n      const gasPrice = new bn_js_1.default(tx.gasPrice);\n      const gas = new bn_js_1.default(receipt.gasUsed);\n      const value = new bn_js_1.default(tx.value);\n      const cost = gasPrice.mul(gas).add(value);\n      const timestamp = typeof block.timestamp === \"string\" ? parseInt(block.timestamp) : block.timestamp;\n      return {\n        timestamp,\n        from: tx.from,\n        balance: shim_1.Web3Shim.utils.fromWei(balance, \"ether\"),\n        gasUnit: \"gwei\",\n        gasPrice: shim_1.Web3Shim.utils.fromWei(gasPrice, \"gwei\"),\n        gas,\n        valueUnit: \"ETH\",\n        value: shim_1.Web3Shim.utils.fromWei(value, \"ether\"),\n        cost\n      };\n    });\n  }\n  displayCost(value) {\n    return shim_1.Web3Shim.utils.fromWei(value, \"ether\");\n  }\n}\nexports.Web3InterfaceAdapter = Web3InterfaceAdapter;","map":{"version":3,"names":["bn_js_1","__importDefault","require","shim_1","Web3InterfaceAdapter","constructor","provider","networkType","arguments","length","undefined","web3","Web3Shim","getNetworkId","eth","net","getId","getBlock","block","getTransaction","tx","getTransactionReceipt","getBalance","address","getCode","getAccounts","estimateGas","transactionConfig","stacktrace","gasEstimate","_a","getBlockNumber","getTransactionCostReport","receipt","transactionHash","blockNumber","balance","from","gasPrice","default","gas","gasUsed","value","cost","mul","add","timestamp","parseInt","utils","fromWei","gasUnit","valueUnit","displayCost","exports"],"sources":["/Users/karimelbarbary/Desktop/test4/devote/node_modules/@truffle/interface-adapter/lib/adapter/web3/index.ts"],"sourcesContent":["import BN from \"bn.js\";\nimport { Web3Shim } from \"../../shim\";\nimport type {\n  InterfaceAdapter,\n  EvmBlockType,\n  Provider,\n  Transaction,\n  TransactionReceipt,\n  TransactionCostReport\n} from \"../types\";\n\nexport interface Web3InterfaceAdapterOptions {\n  provider?: Provider;\n  networkType?: string;\n}\n\nexport class Web3InterfaceAdapter implements InterfaceAdapter {\n  public web3: Web3Shim;\n\n  constructor({ provider, networkType }: Web3InterfaceAdapterOptions = {}) {\n    this.web3 = new Web3Shim({ provider, networkType });\n  }\n\n  public getNetworkId() {\n    return this.web3.eth.net.getId();\n  }\n\n  public getBlock(block: EvmBlockType) {\n    return this.web3.eth.getBlock(block);\n  }\n\n  public getTransaction(tx: string) {\n    return this.web3.eth.getTransaction(tx);\n  }\n\n  public getTransactionReceipt(tx: string) {\n    return this.web3.eth.getTransactionReceipt(tx);\n  }\n\n  public getBalance(address: string) {\n    return this.web3.eth.getBalance(address);\n  }\n\n  public getCode(address: string) {\n    return this.web3.eth.getCode(address);\n  }\n\n  public getAccounts() {\n    return this.web3.eth.getAccounts();\n  }\n\n  public async estimateGas(transactionConfig: Transaction, stacktrace = false) {\n    // web3 does not error gracefully when gas estimation fails due to a revert,\n    // so in cases where we want to get past this (debugging/stacktracing), we must\n    // catch the error and return null instead\n    if (stacktrace === true) {\n      try {\n        const gasEstimate = await this.web3.eth.estimateGas(transactionConfig);\n        return gasEstimate;\n      } catch {\n        return null;\n      }\n    } else {\n      return this.web3.eth.estimateGas(transactionConfig);\n    }\n  }\n\n  public getBlockNumber() {\n    return this.web3.eth.getBlockNumber();\n  }\n\n  public async getTransactionCostReport(\n    receipt: TransactionReceipt\n  ): Promise<TransactionCostReport> {\n    const tx = await this.getTransaction(receipt.transactionHash);\n    const block = await this.getBlock(receipt.blockNumber);\n\n    if (!block) return null;\n\n    const balance = await this.getBalance(tx.from);\n    const gasPrice = new BN(tx.gasPrice);\n    const gas = new BN(receipt.gasUsed);\n    const value = new BN(tx.value);\n    const cost = gasPrice.mul(gas).add(value);\n    const timestamp =\n      typeof block.timestamp === \"string\"\n        ? parseInt(block.timestamp)\n        : block.timestamp;\n\n    return {\n      timestamp,\n      from: tx.from,\n      balance: Web3Shim.utils.fromWei(balance, \"ether\"),\n      gasUnit: \"gwei\",\n      gasPrice: Web3Shim.utils.fromWei(gasPrice, \"gwei\"),\n      gas,\n      valueUnit: \"ETH\",\n      value: Web3Shim.utils.fromWei(value, \"ether\"),\n      cost\n    };\n  }\n\n  public displayCost(value: BN) {\n    return Web3Shim.utils.fromWei(value, \"ether\");\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}